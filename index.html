<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="每日記帳工具 — 語音記帳、圖表分析、Google Sheets 雲端同步" />
  <meta name="theme-color" content="#0f0f23" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💰</text></svg>" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
  <title>每日記帳</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- 頂部導覽 -->
  <header id="app-header">
    <div class="header-left">
      <h1>💰 每日記帳</h1>
    </div>
    <div class="header-right">
      <button id="btn-sync" class="icon-btn" title="同步" aria-label="同步雲端資料" style="display:none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
      </button>
      <button id="btn-google-login" class="google-btn" title="Google 登入" aria-label="Google 登入">
        <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        <span>登入</span>
      </button>
      <div id="user-avatar" class="user-avatar" style="display:none;" title="已登入">
        <img id="user-avatar-img" src="" alt="使用者頭像" />
      </div>
    </div>
  </header>

  <!-- 主要內容區 -->
  <main id="app-main">
    <!-- 記帳頁 -->
    <section id="page-add" class="page active">
      <div class="glass-card form-card">
        <h2>新增記帳</h2>
        <div class="type-toggle" id="type-toggle">
          <button class="toggle-btn active" data-type="expense">支出</button>
          <button class="toggle-btn" data-type="income">收入</button>
        </div>
        <form id="expense-form">
          <div class="form-group">
            <label for="input-date">日期</label>
            <input type="date" id="input-date" required />
          </div>
          <div class="form-group">
            <label for="input-category">分類</label>
            <div class="category-select" id="category-select">
              <button type="button" class="category-dropdown-btn" id="category-dropdown-btn">
                <span id="selected-category-icon">🍽️</span>
                <span id="selected-category-text">飲食</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
              </button>
              <div class="category-dropdown" id="category-dropdown"></div>
            </div>
          </div>
          <div class="form-group">
            <label for="input-amount">金額</label>
            <div class="amount-input-wrapper">
              <span class="currency-symbol">$</span>
              <input type="number" id="input-amount" placeholder="0" min="0" step="1" required />
            </div>
          </div>
          <div class="form-group">
            <label for="input-note">備註</label>
            <input type="text" id="input-note" placeholder="選填" />
          </div>
          <div class="form-actions">
            <button type="button" id="btn-voice" class="voice-btn" title="語音輸入" aria-label="語音記帳">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
              <span class="voice-status">點擊語音記帳</span>
            </button>
            <button type="submit" class="submit-btn" id="btn-submit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              新增
            </button>
          </div>
        </form>
      </div>
      <!-- 語音辨識結果面板 -->
      <div id="voice-result-panel" class="glass-card voice-panel" style="display:none;">
        <h3>🎤 語音辨識結果</h3>
        <p id="voice-raw-text" class="voice-raw"></p>
        <div id="voice-parsed" class="voice-parsed"></div>
        <div class="voice-panel-actions">
          <button id="btn-voice-confirm" class="submit-btn">確認</button>
          <button id="btn-voice-cancel" class="cancel-btn">取消</button>
        </div>
      </div>
    </section>

    <!-- 列表頁 -->
    <section id="page-list" class="page">
      <div class="glass-card">
        <div class="list-header">
          <h2>帳目列表</h2>
          <div class="list-filters">
            <input type="month" id="filter-month" />
            <select id="filter-type">
              <option value="all">全部</option>
              <option value="expense">支出</option>
              <option value="income">收入</option>
            </select>
          </div>
        </div>
        <div id="entries-summary" class="entries-summary"></div>
        <div id="entries-list" class="entries-list">
          <div class="empty-state">
            <p>📝 尚無帳目紀錄</p>
            <p class="sub">到「記帳」頁新增第一筆吧！</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 分析頁 -->
    <section id="page-charts" class="page">
      <div class="charts-header glass-card">
        <div class="chart-month-nav">
          <button id="chart-prev-month" class="icon-btn" aria-label="上個月">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <h2 id="chart-month-label">2026 年 2 月</h2>
          <button id="chart-next-month" class="icon-btn" aria-label="下個月">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </button>
        </div>
      </div>
      <div class="summary-cards" id="summary-cards">
        <div class="summary-card income-card glass-card">
          <span class="summary-label">收入</span>
          <span class="summary-value" id="summary-income">$0</span>
        </div>
        <div class="summary-card expense-card glass-card">
          <span class="summary-label">支出</span>
          <span class="summary-value" id="summary-expense">$0</span>
        </div>
        <div class="summary-card balance-card glass-card">
          <span class="summary-label">結餘</span>
          <span class="summary-value" id="summary-balance">$0</span>
        </div>
      </div>
      <div class="charts-grid">
        <div class="glass-card chart-card">
          <h3>支出分類佔比</h3>
          <div class="chart-container">
            <canvas id="chart-doughnut"></canvas>
          </div>
        </div>
        <div class="glass-card chart-card">
          <h3>每日支出趨勢</h3>
          <div class="chart-container chart-container-wide">
            <canvas id="chart-line"></canvas>
          </div>
        </div>
        <div class="glass-card chart-card">
          <h3>近 6 個月收支比較</h3>
          <div class="chart-container chart-container-wide">
            <canvas id="chart-bar"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- 設定頁 -->
    <section id="page-settings" class="page">
      <div class="glass-card">
        <h2>設定</h2>
        <div class="settings-group">
          <h3>☁️ 雲端同步</h3>
          <div class="setting-item" id="setting-sync">
            <div class="setting-info">
              <span class="setting-label">Google Sheets 同步</span>
              <span class="setting-desc" id="sync-status-text">尚未登入</span>
            </div>
            <button id="btn-settings-login" class="small-btn">登入</button>
          </div>
          <div class="setting-item" id="setting-sheet-url" style="display:none;">
            <div class="setting-info">
              <span class="setting-label">試算表連結</span>
              <span class="setting-desc"><a id="sheet-link" href="#" target="_blank">開啟 Google Sheets</a></span>
            </div>
          </div>
        </div>
        <div class="settings-group">
          <h3>💰 月度預算</h3>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">每月預算上限</span>
              <span class="setting-desc">超過時會顯示警示</span>
            </div>
            <div class="budget-input-wrapper">
              <span>$</span>
              <input type="number" id="input-budget" placeholder="0" min="0" step="100" />
            </div>
          </div>
          <button id="btn-save-budget" class="small-btn">儲存</button>
        </div>
        <div class="settings-group">
          <h3>📥 匯出資料</h3>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">匯出 Excel 檔案</span>
              <span class="setting-desc">匯出所有帳目為 .xlsx</span>
            </div>
            <button id="btn-export-excel" class="small-btn">匯出</button>
          </div>
          <div class="export-options" id="export-options">
            <select id="export-range">
              <option value="all">全部資料</option>
              <option value="month">本月</option>
            </select>
          </div>
        </div>
        <div class="settings-group">
          <h3>🏷️ 分類管理</h3>
          <div id="category-manager"></div>
          <div class="add-category-form">
            <input type="text" id="input-new-category-icon" placeholder="圖示" maxlength="2" class="icon-input" />
            <input type="text" id="input-new-category-name" placeholder="分類名稱" />
            <select id="input-new-category-type">
              <option value="expense">支出</option>
              <option value="income">收入</option>
            </select>
            <button id="btn-add-category" class="small-btn">新增</button>
          </div>
        </div>
        <div class="settings-group">
          <h3>ℹ️ 關於</h3>
          <p class="about-text">每日記帳 v1.0 — PWA 離線記帳 + Google Sheets 雲端同步</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 底部導覽列 -->
  <nav id="bottom-nav">
    <button class="nav-btn active" data-page="add" aria-label="記帳">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      <span>記帳</span>
    </button>
    <button class="nav-btn" data-page="list" aria-label="列表">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      <span>列表</span>
    </button>
    <button class="nav-btn" data-page="charts" aria-label="分析">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <span>分析</span>
    </button>
    <button class="nav-btn" data-page="settings" aria-label="設定">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      <span>設定</span>
    </button>
  </nav>

  <!-- Toast 通知 -->
  <div id="toast-container"></div>

  <!-- 確認對話框 -->
  <div id="confirm-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content glass-card">
      <p id="confirm-message"></p>
      <div class="modal-actions">
        <button id="confirm-yes" class="submit-btn">確認</button>
        <button id="confirm-no" class="cancel-btn">取消</button>
      </div>
    </div>
  </div>

  <!-- 編輯對話框 -->
  <div id="edit-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content glass-card edit-modal-content">
      <h3>編輯帳目</h3>
      <form id="edit-form">
        <input type="hidden" id="edit-id" />
        <div class="form-group">
          <label for="edit-date">日期</label>
          <input type="date" id="edit-date" required />
        </div>
        <div class="form-group">
          <label for="edit-type">類型</label>
          <select id="edit-type">
            <option value="expense">支出</option>
            <option value="income">收入</option>
          </select>
        </div>
        <div class="form-group">
          <label for="edit-category">分類</label>
          <select id="edit-category"></select>
        </div>
        <div class="form-group">
          <label for="edit-amount">金額</label>
          <input type="number" id="edit-amount" min="0" step="1" required />
        </div>
        <div class="form-group">
          <label for="edit-note">備註</label>
          <input type="text" id="edit-note" />
        </div>
        <div class="modal-actions">
          <button type="submit" class="submit-btn">儲存</button>
          <button type="button" id="edit-cancel" class="cancel-btn">取消</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 預算警示橫幅 -->
  <div id="budget-alert" class="budget-alert" style="display:none;">
    <span>⚠️ 本月支出已超過預算！</span>
    <button id="budget-alert-close" class="icon-btn" aria-label="關閉">✕</button>
  </div>

  <script type="module" src="/js/app.js"></script>
</body>
</html>
